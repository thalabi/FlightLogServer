<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="
		http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd
		http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet id="create-view" author="Tarif Halabi">
        <comment>Create flight_log_running_total_v</comment>

    	<createView viewName="flight_log_running_total_v" replaceIfExists="true">
			<![CDATA[
  select fl.flight_date, fl.id, fl.make_model, fl.registration, fl.pic,
          fl.co_pilot, fl.route_from, fl.route_to, fl.day_dual, fl.day_solo,
          fl.night_dual, fl.night_solo, fl.instrument_simulated,
          fl.instrument_flight_sim, fl.x_country_day, fl.x_country_night,
          fl.remarks,
          fl.instrument_imc, fl.instrument_no_ifr_appr, fl.tos_ldgs_day,
          fl.tos_ldgs_night,
          sum (fl.day_dual) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_day_dual,
          sum (fl.day_solo) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_day_solo,
          sum (fl.night_dual) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_night_dual,
          sum (fl.night_solo) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_night_solo,
          sum (fl.instrument_imc) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_instrument_imc,
          sum (fl.instrument_simulated) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_instrument_simulated,
          sum (fl.instrument_flight_sim) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_instrument_flight_sim,
          sum (fl.instrument_no_ifr_appr) over (order by fl.flight_date,
           fl.id range unbounded preceding)
                                                 total_instrument_no_ifr_appr,
          sum (fl.x_country_day) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_x_country_day,
          sum (fl.x_country_night) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_x_country_night,
          sum (fl.tos_ldgs_day) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_tos_ldgs_day,
          sum (fl.tos_ldgs_night) over (order by fl.flight_date,
           fl.id range unbounded preceding) total_tos_ldgs_night,
          sum (nvl(fl.day_dual, 0) + nvl(fl.day_solo, 0) + nvl(fl.night_dual, 0) + nvl(fl.night_solo, 0)
              ) over (order by fl.flight_date, fl.id range unbounded preceding)
                                                                total_to_date
     from flight_log fl
     		]]>    
		</createView>

    </changeSet>

</databaseChangeLog>